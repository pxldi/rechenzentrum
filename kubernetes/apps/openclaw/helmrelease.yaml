---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: openclaw
  namespace: openclaw
spec:
  interval: 30m
  chart:
    spec:
      chart: openclaw
      version: '*'  # Use latest version
      sourceRef:
        kind: HelmRepository
        name: openclaw
        namespace: openclaw
      interval: 12h
  install:
    remediation:
      retries: 3
  upgrade:
    remediation:
      retries: 3
  values:
    env:
      - name: HOME
        value: /tmp
      - name: npm_config_cache
        value: /tmp/.npm
    config:
      agents:
        defaults:
          model:
            primary: "zai/glm-4.7"
          models:
            "zai/glm-4.7":
              alias: "GLM"
    # Use existing secret for API keys
    credentials:
      existingSecret: openclaw-credentials
    
    # Persistence for OpenClaw state
    persistence:
      enabled: true
      storageClass: local-ssd
      size: 10Gi
      accessMode: ReadWriteOnce
    
    # Resource limits
    resources:
      requests:
        memory: 512Mi
        cpu: 250m
      limits:
        memory: 2Gi
        cpu: 1000m
    
    # Security context
    securityContext:
      runAsNonRoot: true
      runAsUser: 1000
      fsGroup: 1000